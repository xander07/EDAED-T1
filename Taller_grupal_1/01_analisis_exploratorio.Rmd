---
title: "Análisis exploratorio de la encuesta inicial"
author: "Jhon J. Serna, Laura Flórez, Karina Jiménez, Johan Paniagua & Alex"
date: "Miércoles, 14 de abril de 2021"
output: 
  html_document: 
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE)
```

El día 24 de febrero de 2021, se inició con la primera clase del curso de estadística descriptiva de 8 a 10 am. En ese lapso de tiempo, el profesor del curso preparó una encuesta de 44 preguntas para cada uno de los matriculados sobre temas muy diversos.

Son justamente esos datos recolectados, los que dan vida a este primer trabajo grupal, pues, sobre ellos debemos realizar una análisis descriptivo y exploratorio. Además, resolver un entramado de 10 preguntas por los integrantes de cada grupo de trabajo y que deben estar asociadas a las variables contenidas en la base de datos generada por la encuesta.


## Librerías y lectura de la BD

Inicialmente, para este trabajo grupal solo se usará la  la **"tidyverse"**, esta no facilita el manejo de las variables a través del código que realicemos en el desarrollo del trabajo.

```{r}
## Paquetes usados en el análisis.
library(tidyverse)
```

Por otra parte, la base de datos que nos fue asignada, viene en formato **CVS**, por lo que, usaremos la función **read.cvs())** que nos ofrece R para importar los datos y así poder trabajar de manera local.

```{r}
## Lectura de una base de datos tipo ".csv"
encuesta <- read.csv("encuesta1.csv")
```


## Visualización inicial de los datos

Una vez importada la base de datos, la visualización es de gran importancia, pues nos permitirá definir si nuestra base de datos necesita o no de un proceso de depuración. Con este primer acercamiento observaremos la cantidad de registros, detalles como el tipo y la estructura de los datos que conforman nuestra base de datos, lo cual, nos ayudará a detectar las anomalías o errores más evidentes que pueden afectar los resultados del análísis que haremos posteriormente.

### Estructura general de la BD

Para generar una vista de la estructura de nuestra base de datos, usaremos las función **glimpse()** que nos ofrece información general como cantidad de datos, cantidad de variables y algunos detalles de las mismas. Veámos:

```{r}
## Vista de la estructura general de la BD.
glimpse(encuesta)
```

En esta primera visualización nos centraremos en el tipo de dato de cada una de las variables (Columnas de la BD) para determinar si son acordes a lo que requerimos o lógicos según nuestro criterio. Por ejemplo, observando los resultados anteriores, las variables que tienen formato de fecha tienen un tipo de dato apropiado para texto como lo es el tipo *Character*, pero este tipo no lo es para las fechas, ya que para estas exite un tipo llamado *Date*. Sólo con esta observación ya sabemos que nuestra base de datos de por lo menos una modificación como proceso de depuración.

Otras variables como Género y Carrera que son de tipo *Character*, podríamos cambiarlas a tipo *Factor*, buscando facilitar su manejo en el proceso de análisis.

Más adelante, en el proceso de depuración, veremos más detalladamente las variables que modificaremos para realizar nuestro análisis, pues ya habremos definido con cuáles vamos a trabajar. Por ahora, visualicemos un poco más nuestra base de datos. Veámos un resumen de cada una de las variables que contiene:

#### Resumen general de los datos que tenemos en la BD

Para generar el resumen de la base de datos, usaremos la función **summary()** de R que nos ofrece un resumen global de nuestra base de datos.

```{r}
summary(encuesta)
```

Como observamos, el resumen global de la base de datos nos permite detectar rápidamente, en las variables cualitativas, la cantidad de registros que tienen y el tipo al que pertenecen, mientras que, en las variables cuantitativas, nos muestra algunas estadísticas básicas como la media, la mediana, el valor máximo y mínimo, los cuartiles, cantidad de datos faltantes, etc., ayudándonos a determinar qué variables pueden requerir modificaciones. Un ejemplo rápido serían las variables Q09_EnAreaMetropolitana o Q14_RecursosInformáticos, que podría ser mejor tenerlas de tipo *Factor* y no de tipo *Numérico*, pues datos como la media y la mediana de estas variables no son importantes para lo que estas variables representan.

Este resumen también nos permite observar algunos valores atípicos, como por ejemplo, el valor máximo en la variable Q08_PAPA que es **45**, superando el rango real **[0.0, 5.0]** que conocemos y al cual debería pertenecer.

De esta manera, con toda la información que nos brinda la visualización general de nuestra base de datos y después de definir algunos criterios para nuestras variables, podemos iniciar el proceso de depuración en donde podremos detallar un poco más el porque de cada modificación.

## Depuración de los datos

### 1. Cambiamos los datos que tienen formato fecha de CHARACTER a DATE.

Este cambio lo realizamos con el fin de facilitar el manejo de las fechas, aprovechando las funciones que nos ofrece R al trabajar con variables de tipo *date*.

Primero, confirmemos que las variables que tienen formato fecha **(AAAA-MM-DD)**, efectivamente, sean de tipo distinto a *date*. Para realizar esto, usaremos las función **str()** que nos ofrece R, y así observar, además del tipo, algunos detalles adicionales.

**Variable:** Q02_FechaNac
```{r}
str(encuesta$Q02_FechaNac)
tail(encuesta$Q02_FechaNac)
```

**Variable:** Q07_FechaSaber11
```{r}
str(encuesta$Q07_FechaSaber11)
tail(encuesta$Q07_FechaSaber11)
```

Ahora que confirmamos que estas variables no son del tipo *Date* que queremos, modifiquemos el tipo usando la función **as.Date()** de R y verifiquemos el cambio, usando nuevamente la funcioón *str()*.

```{r}
## Convertimos la variable Q02_FechaNac a tipo DATE
encuesta <- encuesta %>% 
  mutate(Q02_FechaNac = as.Date(as.character(Q02_FechaNac), "%Y-%m-%d"))

## Convertimos la variable Q07_FechaSaber11 a tipo DATE
encuesta <- encuesta %>% 
  mutate(Q07_FechaSaber11 = as.Date(as.character(Q07_FechaSaber11),"%Y-%m-%d"))
```

**Variable:** Q02_FechaNac
```{r}
str(encuesta$Q02_FechaNac)
```

**Variable:** Q07_FechaSaber11
```{r}
str(encuesta$Q07_FechaSaber11)
```

Como podemos ver, el tipo de dato con el registran las 2 variables ahora es Date, que era lo que buscabamos.

Hay otra vatiable que también tiene formato fecha, aunque realmente es formato fecha / hora **(AAAA/MM/DD hh:mm:ss)**. Detallemos:

**Variable:** Enviado.el.
```{r}
str(encuesta$Enviado.el.)
tail(encuesta$Enviado.el.)
```

Debido a esta "variación" en el formato y para mantenerlo de la forma fecha / hora, el cambio de tipo lo haremos usando la función *as.POSIXct()*.

```{r}
## Convertimos la variable Enviado.el. a tipo POSIXct (DATE TIME)
encuesta <- encuesta %>% 
  mutate(Enviado.el. = as.POSIXct(strptime(Enviado.el., format = "%d/%m/%Y %H:%M:%S")))

```

**Variable:** Enviado.el.
```{r}
tail(encuesta$Enviado.el.)
```

Observemos que ahora el tipo de la variable es *POSIXct*. Este es un tipo especial de R que nos permitirá trabajar con la variables en formato fecha / hora, de manera similar a como el tipo *Date* nos permite trabajar con las variables en formato fecha.

#### 2. Modificamos las variables que quedan de tipo CHARACTER a FACTOR.

Este cambio se hace pensando en la facilidad del manejo de algunas variables, por ejemplo la variable Q03_Carrera podría ser más fácil de manejar si a cada uno de los datos, que son distintos entre sí, se les asigna un valor númerico distinto. De igual manera sucede con las variables que contienen datos provenientes de respuestas de selección múltiple. Para esta modificación usaremos las función *mutate_if()*.

Vamos a hacer seguimiento del cambio visualizando la variable Q01_Genero que actualmente es de tipo Character, con valores entre "1 : Masuclino", "2 : Femenino" o "3 : Otro", confirmemos el tipo con la función *typeof()* y veámos algunos de los datos de esta variable con la función *tail()*:

```{r}
str(encuesta$Q01_Genero)
tail(encuesta$Q01_Genero, 10)
barplot(table(encuesta$Q01_Genero),ylab = "Frecuencia", ylim = c(0, 80), col = c(blues9), main = "Género")
```

Ahora realicemos la modificación de character a factor y visualicemos de nuevo el tipo de dato y algunos datos de la variables Q01_Genero

```{r}
encuesta <- encuesta %>% mutate_if(is.character, as.factor)
str(encuesta$Q01_Genero)
tail(encuesta$Q01_Genero, 10)
barplot(table(encuesta$Q01_Genero),ylab = "Frecuencia", ylim = c(0, 80), col = c(rainbow(3)), main = "Género")
```


#### 3. Modificamos la variable estrato con etiquetas "Bajo, Medio, Alto".

Esta modificación a hacemos con el fin de unificar estratos y evitar que los datos que vayamos a comprar queden muy dispersos.

Para esta clasificación usamos como referencia un documento del DANE, recuperado de su sitio web: https://www.dane.gov.co/files/geoestadistica/Preguntas_frecuentes_estratificacion.pdf

Aunque la clasificación del DANE propone 6 etiquetas, de acuerdo a nuestro objetivo, las compactamos un poco más y así etiquetamos a los estratos 1 y 2 como "Bajo"; estratos 3 y 4 como "Medio"; y los estratos 5 y 6 como "Alto".

Aquí también observamos que había una respuesta que correspondía a un estrato no conocido. Este dato los modificamos como datos faltante *NA*, pues no tenemos información que nos indique si la persona que ingresó esta respuesta pertenece a un estrato Bajo, Medio o Alto.

```{r}
plot(encuesta$Q10_Estrato,col=c(rainbow(6)), , ylim = c(0,50), ylab = "Frecuencia", xlab = "Estrato", las=1  ,main = "Estrato", na.rm = TRUE)
```


```{r}
encuesta <- encuesta %>% mutate(Q10_Estrato = factor(encuesta$Q10_Estrato,
                            levels = levels(encuesta$Q10_Estrato),
                            labels = c("Bajo","Bajo","Medio","Medio","Alto",NA),
                            ordered = F))


str(encuesta$Q10_Estrato)
tail(encuesta$Q10_Estrato)
table(encuesta$Q10_Estrato)
plot(encuesta$Q10_Estrato,col="yellow", , ylim = c(0,80), ylab = "Frecuencia", xlab = "Estrato", las=1  ,main = "Estrato", na.rm = TRUE)
```

#### 4. Forzamos los datos de la variable Q08_PAPA para que queden dentro del intervalo [0.0,5.0]

Cómo observamos en el resumen global de la base de datos, la variable PAPA tiene un valor que máximo que está por fuera del intervalo real [0.0, 5.0]. Miremos con una gráfica los valores que tiene esta variable para analizar que proceso de depuración se puede realizar.

```{r}
plot(encuesta$Q08_PAPA,1:87,col="green",pch = 19, ylab = "Registro", xlab = "PAPA", las=1  ,main = "PAPA por orden de registro", na.rm = TRUE)
```
Bueno, como podemos ver, sólo hay un valor que es anormal en la variable Q08_PAPA. Véamos cuál es ese valor usando la función *max()* que nos permitirá ver cuál es el valor máximo que tiene la variable. Debemos tener en cuenta que hay valores faltantes *NA* entre los valores que puede tomar la variable y para el ver cuál es el valor máximo, debemos omitir estos valores.

```{r}
max(encuesta$Q08_PAPA, na.rm = TRUE)
```
Bueno, ahora que sabemos cuál es valor máximo dentro de la variable Q08_PAPA y sabiendo que es el único valor que está por fuera del intervalo real [0.0, 5.0], asumiremos que la persona que lo ingresó, quizás tuvo problemas para ingresar el punto de separación decimal y siendo este el caso, entonces el valor correcto de este PAPA es 4.5. Por tanto, cambiaremos el valor actual 45 a un valor dentro del intervalo real de la variable, es decir, 4.5.

```{r}
encuesta$Q08_PAPA[encuesta$Q08_PAPA == 45 & !is.na(encuesta$Q08_PAPA)] <- 4.5
```

Después de realizado el cambio confirmemos cuál es el valor máximo que contiene la variable Q08_PAPA y después también confirmaremos graficando los datos.

```{r}
max(encuesta$Q08_PAPA, na.rm = TRUE)
plot(encuesta$Q08_PAPA,1:87,col="blue",pch = 19, ylab = "Registro", xlab = "PAPA", las=1  ,main = "PAPA por orden de registro", na.rm = TRUE)
```


#### 5. Unificamos la escala de los puntajes icfes a una escala de 0 a 500.

Teniendo en cuenta que los puntajes del ICFES registrados en la encuesta pueden tener diferencias en la escala de calificación, dependiendo del año en el que se presentó, hemos decidido unificar las escalas siguiendo las fórmulas implementadas por la UNIMAGDALENA, las cuales están descritas en el sitio web: https://admisiones.unimagdalena.edu.co/inscripcionPRE/conversionICFES.jsp?rnd425615.

Se debe aclarar que la unificación que se hace con las fórmulas mencionadas se ejecuta sobre el puntaje total de la prueba y no sobre los puntajes de cada uno de los módulos que conforman la prueba. En este sentido, se puede tener algún cesgo, ya que los módulos, en distintos años, pueden variar el peso que tienen sobre el puntaje final. No obtaste, nos da un aproximado confiable con el que podemos trabajar.

También debemos aclarar que:

1. los valores que son 0 se convierten a valores faltantes *NA*, ya que, no nos parece lógico haya obtenido el puntaje, sino que, quizás no recordaba su puntaje y por eso puso ese valor.

2. Los que ya figuraban como valores faltantes *NA*, se dejan igual.

3. Observamos que habían puntajes que no correspondían a la escala del año en el que presentaron el ICFES, sino, que correspondía a la escala actual de la prueba. Esos puntajes los dejaremos igual ya que asumimos que al momento de ingresar los el puntaje, hicieron la conversion a la escala actual.

4. También se observó que había un valor que registraba por encima de 500 el año de la fecha de presentación de la prueba Saber 11 correspondía a un año en el que la calificación usaba la escala de 0 a 500, como este valor no es lógico, lo convertimos a valor faltante *NA*.

5. Como última observación, tenemos que hay un puntaje registra como puntaje perfecto *500*, pero consultamos y en la web: https://www.bluradio.com/blu360/santanderes/el-mejor-icfes-de-colombia-revelo-el-secreto-para-obtener-el-puntaje-mas-alto encontramos que el puntaje más alto de ese año fue de 478, por tanto, este puntaje los convertiremos a valor faltante *NA* ya que no es lógico.

```{r}
saber11 <- vector("integer", length(encuesta$Q05_Saber11))
for(i in seq_along(encuesta$Q07_FechaSaber11)){
  valor<-0
  if(!is.na(encuesta$Q05_Saber11[[i]]) & encuesta$Q07_FechaSaber11[[i]] < as.Date("2000-01-01")) {
    valor <- (5*(encuesta$Q05_Saber11[[i]]-100))/3
    if(valor >= 0 & valor <= 500){
      saber11[[i]] <- round(valor,0)
    } else {
      saber11[[i]] <- encuesta$Q05_Saber11[[i]]
    }
  } else if(!is.na(encuesta$Q05_Saber11[[i]]) & encuesta$Q07_FechaSaber11[[i]] >= as.Date("2000-01-01") &
        encuesta$Q07_FechaSaber11[[i]] < as.Date("2012-01-01")){
            valor <- encuesta$Q05_Saber11[[i]]*5
            if(valor >= 0 & valor <= 500){
              saber11[[i]] <- valor
            } else {
              saber11[[i]] <- encuesta$Q05_Saber11[[i]]
            }
  } else if(!is.na(encuesta$Q05_Saber11[[i]]) & encuesta$Q07_FechaSaber11[[i]] >= as.Date("2012-01-01")){
            saber11[[i]] <- encuesta$Q05_Saber11[[i]]
  } else{
      saber11[[i]] <- encuesta$Q05_Saber11[[i]]
  }
}
## Si quedó algún valor fuera del rango [0, 500] lo convertimos en un NA
saber11[saber11 >= 500 & !is.na(saber11)] <- NA
saber11[saber11 <= 0 & !is.na(saber11)] <- NA
encuesta$Q05_Saber11 = saber11

plot(encuesta$Q05_Saber11,1:87,col="red",pch = 19, ylab = "Registro", las=1  ,main = "Puntaje SABER 11 por orden de registro", na.rm = TRUE)
```

#### 6. Calculamos la edad de los encuestados de acuerdo a su fecha de nacimiento.

En este punto usaremos una de las variables que modificamos anteriormente. En este caso usaremos la variable Q02_FechaNac para calcular la edad de cada uno de los encuestados, de acuerdo a la fecha de nacimiento que ellos ingresaron. Se debe tener en cuenta que para este cálculo, se usa la fecha 2021/06/30 como fecha referencia para el año en curso, pues es una fecha central que nos ayuda a equilibrar el tiempo que hay entre los encuestados que cumplen a comienzo de año y los que cumplen a final de año.

También, definimos que un año tiene 365.25 días. Esto con el fin de tener en cuenta los años que son bisiestos.

La edad quedará como un número decimal, para mayor exactitud si tenemos en cuenta la fracción de un año que puede agregarse a la edad después de pasada la fecha del cumpleaños.

```{r}
# Cálculo de la edad
edad <- as.numeric(as.Date("2021-06-30") - encuesta$Q02_FechaNac)/365.25
```
```{r}
str(edad)
```
```{r}
plot(edad,1:87,col="blue",pch = 19, ylab = "Registro", las=1, main = "Edad por orden de registro")
```

#### 7. Etiquetamos las variables Q24_area y Q26_Divisor como "Correcto/Incorrecto."

Esta modificación si es muy intuitiva. En esencia, creemos que al comparar esta variables con otras, nos aporta más el hecho de saber si fueron respondidas de forma Correcta o Incorrecta que el hecho de saber cuál fue exactamente la respuesta del encuestado.

```{r}
## Creamos la variable area que contiene la variable Q24_area etiquetada como "Correcto/Incorrecto"  
area <- encuesta$Q24_area
area = factor(area, 
              levels = levels(area),
              labels = c("Incorrecto","Incorrecto","Incorrecto","Correcto","Incorrecto","Incorrecto"),
              ordered = F)

```
```{r}
## Creamos la variable divisor que contiene la variable Q26_Divisor etiquetada como "Correcto/Incorrecto".
divisor = if_else(encuesta$Q26_Divisor..f.es.divisor.de.g.2.==1 & encuesta$Q26_Divisor..f.es.divisor.de.gh.==1 & encuesta$Q26_Divisor..f.es.divisor.de.h.g==1, "Correcto", "Incorrecto")
divisor

```

#### 8. Etiquetamos la variable Q01_Genero como "Masculino,Femenino u Otro".

Este cambio se realiza para facilitar el manejo de esta variable, ya que es mucho mejor identificar el género como variable categórica, en de vez de una variable de tipo factor.
```{r}

encuesta <- encuesta %>% 
  mutate(Q01_Genero = as.character(encuesta$Q01_Genero))

encuesta$Q01_Genero[encuesta$Q01_Genero ==	 "1 : Masculino" ] <- "Masculino"

encuesta$Q01_Genero[encuesta$Q01_Genero ==	 "2 : Femenino" ] <- "Femenino"

encuesta$Q01_Genero[encuesta$Q01_Genero ==	 "3 : Otro" ] <- "Otro"

encuesta <- encuesta %>% 
  mutate(Q01_Genero = as.factor(encuesta$Q01_Genero))

```
#### Visualicemos nuevamente nuestros datos y su estructura después de la depuración.

Una vez realizada la depuración veamos la nueva estructura de nuestra base de datos.

```{r}
glimpse(encuesta)
```

```{r}
summary(encuesta)

```
## Desarrollo de las preguntas 

### 1. Preguntas bivariadas.   

#### 1.1 ¿Los estudiantes que tienen mejor PAPA se encuentran en la carrera de ing en sistemas?

El supuesto que se tiene en esta pregunta es que si, los estudiantes que están cursando la carrera de ingeniería en sistemas tienen un PAPA más alto que quienes están cursando estadística, esto debido a que, se podría pensar que los ingenieros en sistemas son más dedicados ya que su carrera es muy demandada, entonces siempre se seleccionan los mejores, además,saben mas de manejo computacional que un estudiante de estadística. 

Para responder a esta pregunta, en primer lugar lo que se hizo fue analizar qué carreras están cursando los estudiantes del curso de estadística descriptiva y exploratoria. Dentro de las respuestas se encontró diversas carreras, de las cuales se destacan estadística, ing de sistemas, ing industrial, ing física, ing administrativa y otra. Cabe destacar, que las carreras que más número de estudiantes presentan son ing en sistemas y estadística. De allí, que fueran estas dos las elegidas para  realizar el cruce bivariado. 

A continuación se presenta una tabla donde se muestra la cantidad de estudiantes por cada carrera y se saca también el promedio del PAPA. En la carrera de estadística hay exactamente 54 estudiantes, y en ing en sistemas 26. Una diferencia que alcanza a ser el doble.Es normal que suceda esto, pues el curso de estadística descriptiva y exploratoria es obligatorio para quienes estudian estadística y optativo para quienes hacen otras carreras, de allí que se perciba mayor presencia de los estudiantes de estadística. 

En este sentido, para hallar el Promedio acumulado ponderado (PAPA) que tiene una escala de 1 a 5, se sumó cada PAPA reportado por los estudiantes de estadística y de ing en sistemas, ambos por separado, y posteriormente se dividió por la cantidad de personas de las dos carreras

A partir de la tabla que se realizó, se procedió a graficar un boxplot. Donde se muestra, a través de una caja que divide los datos en cuatro cuartiles, que el 50% de los estudiantes presentan un PAPA aproximado de 4,03 o menos y los de ing en sistemas de 4,06. Una diferencia demasiado pequeña a lo que se tenía pensado. Entonces, esto nos permite ver que la hipótesis que se planteó es verdadera. Sin embargo, hay que resaltar que la diferencia entre ambas es de tan solo 0,03 centésimas. 

También hay que mencionar que en las dos carreras hay personas con un PAPA de casi 4,6. Mientras que, el valor mínimo de PAPA lo presentan los de estadística con un 3,0 y el de los ingenieros es de más o menos 3,4. (Ver gráfica 1:  Carrera vs PAPA)

### Resumen numérico 
 
```{r}
encuesta_sist_estad <- encuesta %>% 
  filter(Q03_Carrera %in% c("2 : Ingeniería de sistemas e informática",
                            "3 : Estadística")) %>% 
  droplevels()
encuesta_sist_estad_resumen <- encuesta_sist_estad %>%
  group_by(Q03_Carrera) %>% 
  mutate(num_estud_carrera = n()) %>% 
  group_by(Q03_Carrera, num_estud_carrera) %>% 
  summarise(num_estud_noNA = sum(!is.na(Q08_PAPA)),
            prom_PAPA = mean(Q08_PAPA, na.rm = TRUE),
            desv_PAPA = sd(Q08_PAPA, na.rm = TRUE)) %>% 
  mutate(porcent_x_carrera = num_estud_noNA / num_estud_carrera * 100)
encuesta_sist_estad_resumen %>% data.frame()
```

### Gráfica exploratoria Carrera Vs PAPA

```{r}
boxplot(Q08_PAPA~ Q03_Carrera, data = encuesta_sist_estad, col = "bisque" , log = "y")
title("Carrera VS PAPA")
points(encuesta_sist_estad_resumen$Q03_Carrera, encuesta_sist_estad_resumen$prom_PAPA, col = "red", pch = 19)
legend("bottomright", legend = c("PromedioPAPA"), pch =19, col = "red")
```

#### 1.2 ¿Qué estrato tienen mejor PAPA?

El supuesto que se tiene a la hora de plantear esta pregunta, es que los estudiantes que pertenencen a un estrato mas alto son quienes tienen mejor PAPA, esto debido a que, han tenido más posibilidades de acceder a mejores recursos, tanto económicos como académicos.

```{r}
estratos_sin_na <- encuesta %>%
  filter(Q10_Estrato == "Alto" | Q10_Estrato == "Medio" | Q10_Estrato == "Bajo")
  

tabla_PAPA <- estratos_sin_na %>%
  group_by(Q10_Estrato) %>% 
  summarise(num_estud = sum(!is.na(Q08_PAPA)),
            prom_PAPA = mean(Q08_PAPA, na.rm = TRUE),
            desv_PAPA = sd(Q08_PAPA, na.rm = TRUE)) 
tabla_PAPA <- data.frame(tabla_PAPA)
tabla_PAPA
```

```{r, fig.height=8, fig.width=8}

 with(encuesta, 
      plot(Q10_Estrato, Q08_PAPA, notch = TRUE,
           las = 2,
           col = "lightblue",
           main = "PAPA vs estrato",
           ylab = "Promedio Académico Ponderado Acumulado",
           xlab = "Estrato",
           pch = 19))
 with(tabla_PAPA, 
      points(Q10_Estrato, prom_PAPA, 
            col = "red", pch = 19))
```
En la tabla se puede observar la cantidad de estudiantes por estatos bajo, medio y alto, con su promedio PAPA.

En la gráfica podemos ver que si hay  diferencia entre los desempeños academicos por estratos, tambien vemos que el intervalo de confianza del estrato bajo es mas grande que el intervalo de confianza del estrato medio, ya que hay mas cantidad de personas en estrato medio que en el bajo. Podemos ver que solamente hay una persona en estrato alto con un buen promedio PAPA que es de 4,3. Sin embargo los de estrato bajo y medio la gran mayoria tiene buen promedio PAPA por lo que para los dos estratos su mediana es más de 4,0.

#### 1.3 ¿Qué género tiene mayor presencia en la carrera de estadística e ingeniería de sistemas?

El supuesto del que se parte es que, en ambas carreras hay mayor presencia de los hombres. A través de la historia las mujeres han sido marginadas de la vida pública y también de lo que se llaman las ciencias duras. Por esta razón se cree, que esto continua pasando aunque en un menor porcentaje, a lo que pasaba anteriormente.

Para responder a esta pregunta lo que se hizo fue filtrar 

```{r}
gencar <- filter(encuesta_sist_estad, Q03_Carrera == "2 : Ingeniería de sistemas e informática" | Q03_Carrera == "3 : Estadística")

gencar <- select(gencar,Q01_Genero,Q03_Carrera)

gencar1 <- table(gencar)
barplot(gencar1, beside = T, col = c(rainbow(3)), 
        legend.text = row.names(gencar1), 
        names= c("Ing sistemas", "Estadística"),
        ylim = c(0,40),
        xlim = c(0,10),
        main = "Carrera VS Género")
```
 


### 2. Preguntas multivariadas

#### 2.1 ¿El puntaje alto en las pruebas Saber11 y el PAPA de los estudiantes del curso de estadística descriptiva y exploratoria dependen de su estrato socioeconómico?

En el grupo después de discutir esta pregunta, se llegó a la conclusión, que nada tiene que ver el hecho de pertenecer a determinado estrato con el puntaje de las pruebas saber 11 y el PAPA, pues se ha visto en muchas ocasiones como en los estratos bajos y altos hay gente con muy buenos resultados académicos. 

Con la gráfica que a continuación se presenta, se relacionan las variables pruebas saber11, PAPA y estrato socioeconómico de los estudiantes del curso, y se desea saber con certeza, si el estrato socioeconómico influye en buenos resultados tanto en las pruebas que realiza el Estado y en la universidad.

Para la realización del gráfico de dispersión, hay que mencionar que solo se tomaron el estrato bajo  y medio como referentes, pues la mayoría de personas pertenecen a este estrato, y solo una persona reportó pertenecer al estrato 5. Entonces el tamaño de la muestra de este último es mínima. 

#### Resumen numérico Estrato Vs Saber 11 
```{r}
estratos_sin_na <- encuesta %>%
  filter(Q10_Estrato == "Medio" | Q10_Estrato == "Bajo")
```

```{r}
tabla_Saber11 <- estratos_sin_na %>%
  group_by(Q10_Estrato) %>% 
  summarise(num_estud = sum(!is.na(Q05_Saber11)),
            prom_Saber = mean(Q05_Saber11, na.rm = TRUE),
            desv_Saber = sd(Q08_PAPA, na.rm = TRUE)) 
tabla_Saber11 <- data.frame(tabla_Saber11)
tabla_Saber11

```

```{r}
encuesta_Estrato1 <- encuesta %>% 
  filter(Q10_Estrato == "Bajo")
```

```{r}
encuesta_Estrato2 <- encuesta %>%
  filter(Q10_Estrato == "Medio")
```

#### Gráfica Estrato socioeconomico VS PAPA y pruebas saber11

```{r}
op <- par(no.readonly = TRUE)
par(mfrow = c(1, 2))
with(encuesta_Estrato1, scatter.smooth(Q05_Saber11, Q08_PAPA,main="Saber11 y PAPA vs Estrato bajo ",xlab="Icfes", ylab="PAPA",pch=19, ylim=c(3,5),xlim=c(0,500), col = "bisque1"))

with(encuesta_Estrato2, scatter.smooth(Q05_Saber11, Q08_PAPA,main="Saber11 y PAPA vs Estrato medio",xlab="Icfes", ylab="PAPA",pch=19, ylim=c(3,5),xlim=c(0,500), col = "cadetblue"))
par(op)

```
Conclusión:

En el gráfico se puede observar, que la dispersión de ambos es muy similar, hay incluso muchos datos que se trasladan. Sin embargo, en el estrato medio hay un dato que muestra que hubo una persona que sacó cero en el icfes, y un promedio aproximado de 3,4. Mientras que, en el estrato bajo, la peor nota de icfes es de 200 y un promedio de 3,3. También hay que resaltar que en ambos gráficos hay personas con muy buen PAPA y resultados en prueba saber. 

A partir entonces de los resultados obtenidos en la gráfica, podemos concluir que la hipótesis planteada sigue teniendo vigencia. No se puede establecer que quienes están en un mejor estrato son mejores académicamente.



#### 2.2 ¿El puntaje promedio de las pruebas saber 11 es más alto dependiendo del estrato socioeconómico y de la edad?

Después de una discusión grupal se llegó a la conclusión de que para poder analizar esta pregunta debemos dividir los datos en grupos de la siguiente manera:

- Edad: Se dividió en tres grupos comenzando desde la edad mínima (que es aproximadamente 17 años) hasta la edad máxima (que es de 39 años), se tomó la diferencia entre las edades mínima y máxima y se dividió en 3, dejando los grupos de la siguiente manera:
  - Joven: Edad de entre 17 a 25 años
  - Adulto Joven: Edad entre 25 a 32 años
  - Adulto: Edad entre 32 a 39 años
  
- Estrato: Se mantuvo la clasificación previa de estratos (Bajo, Medio, Alto).

- Saber 11: Se promedió los resultados dentro de cada subgrupo para así poder realizar un análisis más sencillamente ya que son muchos datos para analizar uno por uno y poder dar una conclusión acertada.

Predicción: Se espera que los jóvenes de estratos medios tengan un mejor promedio de puntaje de las pruebas Saber 11 ya que éstas personas por su situación económica donde tienen mayor acceso a recursos tecnológicos pueden acceder a mayor información y que por su edad, al ser los más jóvenes del curso de Estadística, tendrán mejores resultados debido a que la educación va mejorando y es más avanzada conforme pasan los años.

### Seleccionamos el conjunto de datos necesario para responder las preguntas planteadas
```{r}

gen_edad <- data.frame(encuesta$Q10_Estrato,saber11,edad,encuesta$Q01_Genero)

#Aquí filtramos los datos ya que el NA no debe ser tenido en cuenta
gen_edad <- filter(gen_edad, encuesta.Q10_Estrato == "Bajo" |
                     encuesta.Q10_Estrato == "Medio" |
                     encuesta.Q10_Estrato == "Alto")

gen_edad$edad[(gen_edad$edad <= 25)] <- 1
gen_edad$edad[(25 < gen_edad$edad & gen_edad$edad <= 32)] <- 2
gen_edad$edad[(32 < gen_edad$edad & gen_edad$edad <= 39)] <- 3

gen_edad <- gen_edad %>% 
  mutate(edad = as.character(gen_edad$edad))

gen_edad$edad[(gen_edad$edad == "1")] <- "Joven"
gen_edad$edad[(gen_edad$edad == "2")] <- "Adulto Joven"
gen_edad$edad[(gen_edad$edad == "3")] <- "Adulto"


```
## Análisis numérico
```{r} 
#Seleccionamos los datos a analizar para la edad Joven

promedio_joven <- filter(gen_edad,edad=="Joven")
promedio_joven <- select(promedio_joven,encuesta.Q10_Estrato,saber11,edad)
promedio_joven <- promedio_joven %>%
  group_by(encuesta.Q10_Estrato)%>%
  summarise(promedio=mean(saber11, na.rm = TRUE))
promedio_joven

```

```{r}
promedio_adjoven <- filter(gen_edad,edad=="Adulto Joven")
promedio_adjoven <- select(promedio_adjoven,encuesta.Q10_Estrato,saber11,edad)
promedio_adjoven <- promedio_adjoven %>%
  group_by(encuesta.Q10_Estrato)%>%
  summarise(promedio=mean(saber11, na.rm = TRUE))
#Añadimos 0 en la columna saber 11 para los estratos que no contiene
#Esto se hace para tener una matriz de la misma magnitud
otros <- data.frame(encuesta.Q10_Estrato = c("Alto"),
                    promedio = c(0))
promedio_adjoven <- rbind(promedio_adjoven,otros)
promedio_adjoven

```

```{r}
#Seleccionamos los datos a analizar para la edad Adulto
promedio_adulto <- filter(gen_edad,edad=="Adulto")
promedio_adulto <- select(promedio_adulto,encuesta.Q10_Estrato,saber11,edad)
#Añadimos 0 en la columna saber 11 para los estratos que no contiene
#Esto se hace para tener una matriz de la misma magnitud
otro <- data.frame(encuesta.Q10_Estrato = c("Bajo","Alto"),
                   saber11 = c(0,0),
                   edad=c("Adulto","Adulto"))
promedio_adulto <- rbind(promedio_adulto,otro)
promedio_adulto <- promedio_adulto %>%
  group_by(encuesta.Q10_Estrato)%>%
  summarise(promedio=mean(saber11, na.rm = TRUE))

```
### Unificamos los tres subconjuntos anteriores para graficarlos juntos
```{r}
#Unificamos todo en una sola matriz

tabla_general <- rbind(c(promedio_joven$promedio),
                       c(promedio_adjoven$promedio),
                       c(promedio_adulto$promedio))

```

```{r}
#Le damos nombre a las columnas y filas

colnames(tabla_general) = c("Bajo","Medio","Alto")
rownames(tabla_general) = c("Joven","Adulto Joven","Adulto")
tabla_general

```
### Resultados gráficos
```{r}
barplot(tabla_general, beside = T,
        col = c("Orange","Yellow","Blue"),
        legend.text = row.names(tabla_general),
        ylim = c(0,500),
        xlim = c(0,15),
        main="SABER11xEDADxESTRATO",
        xlab = "Estrato Socioeconómico",
        ylab= "Promedio Saber 11")
```
 Conclusiones:

Como se puede observar en la gráfica anterior, el supuesto del cual partimos era erróneo y podemos ver que en promedio las personas de edad entre los 25 y los 32 años de estrato medio fueron quienes obtuvieron un mejor promedio en las pruebas saber 11, cabe resaltar que para el grupo de las personas adultas y de estrato medio una de ellas obtuvo un resultado de 0 en el saber 11, aunque no es posible determinar si al momento de realizar la encuesta desconocía su puntaje o porque realmente fue lo que obtuvo, puede afectar el resultado previo de modo que sean los adultos estrato medio sean quienes mejor promedio saber 11 tengan o manteniendo el resultado actual.

Si bien pudimos analizar la pregunta anterior dependiendo al estrato y la edad, ahora nos permitiremos realizar un análisis similar:

#### 2.3 ¿El promedio del puntaje saber 11 es más alto dependiendo del estrato y el género?

Después de una discusión grupal se llegó a la conclusión que trabajaremos con la misma agrupación por estrato y categoría de géneros previamente establecida en la depuración, además de que no se tendrá en cuenta el género "Otro" ya que es un único dato, el cual no aporta mucho a este análisis. Además, el dato que está en la fila con estrato "NA" no será tenido en cuenta por la misma razón.

Predicción: Se espera que las mujeres de estrato medio tengan un mejor promedio de resultados saber 11 ya que en general las mujeres son mucho más dedicadas que los hombres en cuanto a temas académicos y está demostrado que ellas tienen una mayor facilidad para aprender que los hombres, además que para el estrato socioeconómico en el que se encuentran tienen acceso a los recursos necesarios para aprender y motivación suficiente para sacarle provecho.

## Análisis Numérico
```{r}
#Seleccionamos los datos de acuerdo al género Femenino
promedio_mujer <- filter(gen_edad,encuesta.Q01_Genero =="Femenino")
promedio_mujer <- select(promedio_mujer,encuesta.Q10_Estrato,saber11)
promedio_mujer <- promedio_mujer %>%
group_by(encuesta.Q10_Estrato)%>%
  summarise(promedio=mean(saber11, na.rm = TRUE))
#Añadimos 0 al promedio de mujeres en estrato Alto para que todos los dataframes
#Tengan la misma dimensión
ot <- data.frame(encuesta.Q10_Estrato = c("Alto"),
                 promedio = c(0))
promedio_mujer <- rbind(promedio_mujer,ot)
promedio_mujer
```

```{r}
#Seleccionamos los datos de acuerdo al género Masculino
promedio_hombre <- filter(gen_edad,encuesta.Q01_Genero =="Masculino")
promedio_hombre <- select(promedio_hombre,encuesta.Q10_Estrato,saber11)
promedio_hombre <- promedio_hombre %>%
group_by(encuesta.Q10_Estrato)%>%
  summarise(promedio=mean(saber11))
promedio_hombre

```
## Unificamos los datos anteriores enuna única matriz
```{r}
#Unificamos todo en una sola matriz

tabla_generos <- rbind(c(promedio_hombre$promedio),
                       c(promedio_mujer$promedio))

```

```{r}
#Le damos nombre a las columnas y filas

colnames(tabla_generos) = c("Bajo","Medio","Alto")
rownames(tabla_generos) = c("Hombre","Mujer")
tabla_generos

```
## Resultados Gráficos

```{r}
barplot(tabla_generos, beside = T,
        col = c("Green","Black"),
        legend.text = row.names(tabla_generos),
        ylim = c(0,500),
        xlim = c(0,11),
        main="SABER11xGENEROxESTRATO",
        xlab = "Estrato Socioeconómico",
        ylab= "Promedio Saber 11")

```
Conclusiones:

Como podemos observar en la gráfica nuestra predicción fue errónea,podemos notar que el promedio de resultados saber 11 es muy similar para los hombres de estrato bajo y medio, además de que quienes sacaron mejor promedio en los resultados saber 11 fueron los hombres de estrato alto y no las mujeres de estrato medio como se esperaba, de hecho, fue este subgrupo quienes peor promedio de resultados saber 11 obtuvieron.


#### 2.4 ¿Qué estrato de la carrera de estadística  tiene mejor PAPA?

La suposición que nos planteamos fue que los de estrato alto de la carrera de estadística tienen mejor PAPA que los de estrato bajo

### resumen numérico 
```{r}
p_pre2 <- encuesta %>%
  select(Q03_Carrera, Q10_Estrato) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"4 : 3","3")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"3 : 2","2")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"2 : 1","1")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"5 : 4","4")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"6 : 5","5")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"8 : No se conoce","N")) %>%
  group_by(Q10_Estrato, Q03_Carrera) %>%
   summarise(Cantidad = n())
 filter(p_pre2)

```
### Grafica Exploratoria
```{r}
p_pre2 <- encuesta %>%
  select(Q03_Carrera, Q08_PAPA, Q10_Estrato, Respuesta, Enviado.el.) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"4 : 3","3")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"3 : 2","2")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"2 : 1","1")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"5 : 4","4")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"6 : 5","5")) %>% 
  mutate(Q10_Estrato = str_replace(Q10_Estrato,"8 : No se conoce","N")) %>%
  mutate(Q08_PAPA = str_replace(Q08_PAPA,"45.0","4.5")) %>%
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"2 : Ingeniería de sistemas e informática","I_Sistemas")) %>%
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"5 : Ingeniería física","I_Física")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"1 : Matemáticas","Matematicas")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"3 : Estadística","Estadística")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"6 : Ingeniería industrial","I_Indus")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"7 : Otra","otra")) %>%  
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"4 : Ingeniería administrativa","I_Admi")) %>% 
  group_by(Q10_Estrato, Q03_Carrera) %>% 
  summarise(Cantidad = n())


coplot(p_pre2$Q10_Estrato ~ p_pre2$Cantidad | p_pre2$Q03_Carrera, columns = 7, cex=1)

```
Conclusion:

La conclusión a la que se llegó es que la mayoría de estudiantes del curso de estadística descriptiva están en estrato medio. Además, se quería saber si se ubican en una sola carrera o están repartidos en todas.

Se observa  que, el estrato medio  domina y cuenta con total de 25 estudiantes en cierta carrera, la cual es superior a las demás cantidades por estrato, también deducimos que el estrato 3 no esta en un sola carrera ,es decir se ubica en 5 carrerasde las 7 carreras en total lo cual es muy deducible saber que es el estrato en el que están la mayoría de estudiantes del curso ,ahora observamos que no están repartidos en todas las carreras ,pero lo mas a la vista que podemos sacar de la gráfica es que la carrera que tiene mayor cantidad de estudiantes en estrato 3 es estadística con 25 estudiantes  y después de estadística sigue ingeniería de sistemas con 15, con esto concluimos que la suposición que hicimos donde el estrato 3 es el estrato donde están la mayoría de estuantes se cumple y también averiguamos que ese estrato se ubica en la mayoría de carreras.

#### 2.5 ¿Por cada carrera que edad tiene mejor puntaje saber 11?

Suponemos que los de 17 años tienen mejor puntaje saber 11 que los de  edades mayores (25 a 30 años) esto debido a que en la actualidad hay mas recursos y se emplean mejores métodos de estudio por lo cual es mas probable obtener un puntaje mejor. 

#### Resumen numérico
```{r}
pregunta2 <- encuesta %>% 
  mutate(Edad = as.numeric(as.Date("2021-06-30") - as.Date(encuesta$Q02_FechaNac))/365) %>% 
  select(Edad, Q05_Saber11, Q08_PAPA, Q03_Carrera) %>%
  mutate(Q08_PAPA = str_replace(Q08_PAPA,"45.0","4.5")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"2 : Ingeniería de sistemas e informática","I_Sistemas")) %>%
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"5 : Ingeniería física","I_Física")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"1 : Matemáticas","Matematicas")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"3 : Estadística","Estadística")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"6 : Ingeniería industrial","I_Indus")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"7 : Otra","otra")) %>%  
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"4 : Ingeniería administrativa","I_Admi")) 
filter(pregunta2)

```
### Grafica Exploratoria
```{r}
pregunta2 <- encuesta %>% 
  mutate(Edad = as.numeric(as.Date("2021-06-30") - as.Date(encuesta$Q02_FechaNac))/365) %>% 
  select(Edad, Q05_Saber11, Q08_PAPA, Q03_Carrera) %>%
  mutate(Q08_PAPA = str_replace(Q08_PAPA,"45.0","4.5")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"2 : Ingeniería de sistemas e informática","I_Sistemas")) %>%
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"5 : Ingeniería física","I_Física")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"1 : Matemáticas","Matematicas")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"3 : Estadística","Estadística")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"6 : Ingeniería industrial","I_Indus")) %>% 
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"7 : Otra","otra")) %>%  
  mutate(Q03_Carrera= str_replace(Q03_Carrera,"4 : Ingeniería administrativa","I_Admi")) 

coplot(pregunta2$Q05_Saber11 ~ pregunta2$Edad | pregunta2$Q03_Carrera, columns = 7, cex=1)

```

Conclusión: 

Lo primero que miramos en la gráfica es que la comparación se puede hacer solo conciertas carreras ,esto debido a que carreras como “Administrativa”, ”Física” y “otra” solo manejan un dato por tanto en estas carreras no es posible aplicar la comparación anterior ,por otro lado miramos que en estadística el mayor puntaje saber 11 lo obtuvo un estudiante mayor de 25 años y en “Sistemas” también pasa lo anterior dicho donde el mayor puntaje lo obtuvo un estudiante mayor de 25 años por tanto en estas 2 carreras la suposición planteada no se cumple.

respecto a “Industrial” y “matemáticas” observamos que la suposición hecha si se cumple también diríamos que esto es por los pocos datos que presentan estas 2 carreras ,claramente miramos en estas 2 carreras que los mejores puntajes lo obtuvieron estudiantes con menor edad y no los de mayor edad 
concluimos que la suposición planteada coincidió con ciertas carreas no con todas al mirar ,los resultados obtenidos fueron muy diferentes. 

#### 2.6 ¿El género que tiene mejor promedio PAPA depende del estrato en que este?

Supuesto: La gran mayoría de mujeres tienden a ser mas dedicadas que los hombres, aunque de esto no depende el estrato, pero si puede que influya en el esfuerzo que se debe hacer para llegar a estos resultados, ya que a los de estrato bajos por falta de recursos y de apoyo muchas veces les toca más difícil.

Llegamos a esta conclusión realizando una evaluación del entorno. Donde se evidencia que una persona al tener todos los recursos no se esfuerza por conseguir mas y por esto el promedio PAPA puede ser mas bajo. Contrario a lo que con personas de pocos recursos, se percibe mayor esfuerzo academicamente, esto con el propósito de superarsen.

```{r}
#gen_estr_papa <- na.exclude(encuesta)

#gen_estr_papa <- select(gen_estr_papa, Q01_Genero, Q10_Estrato, Q08_PAPA)

```
##pregunta 7


## Recomendaciones 

1.Incliur en las respuestas a las preguntas mas opciones de tipo categóricas, para posteriormente no tener que hacer tanta modificaciones en la base de datos orinal.

2.Preguntar directamente por la edad del estudiante y no por la fecha de nacimiento, esto posibilita mejor comprensión.


 



